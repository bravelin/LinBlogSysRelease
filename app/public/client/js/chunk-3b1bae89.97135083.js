(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3b1bae89"],{"15c2":function(t,e,n){"use strict";var i=n("db4b"),r=n("5fe5"),o=n("b146");t.exports=function(t){var e=i(this),n=o(e.length),a=arguments.length,s=r(a>1?arguments[1]:void 0,n),c=a>2?arguments[2]:void 0,l=void 0===c?n:r(c,n);while(l>s)e[s++]=t;return e}},"1c74":function(t,e,n){var i=n("b2f5");i(i.P,"Array",{fill:n("15c2")}),n("644a")("fill")},"3ad6":function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div")},r=[],o=(n("f763"),n("eb57")),a={data:function(){return{catalog:[],showPreview:!1,previewList:[],previewIndex:0}},mounted:function(){var t=this;t.$store.commit(o["a"].SWITCH_LOADING,!1),t.$nextTick(function(){window.addEventListener("scroll",t.doHandlerScroll);var e=document.querySelectorAll("code");e.length>0&&e.forEach(function(t){hljs.highlightBlock(t)});var n=document.querySelectorAll("h3.title");if(n.length>0){var i=[],r=Math.round(1e6*Math.random()),o="";t.catalog=n.forEach(function(t,e){o="section"+r+"-"+e,t.setAttribute("id",o),i.push({text:t.innerHTML,id:o,el:t,active:!1})}),t.catalog=i}var a=document.querySelectorAll(".content figure>img");a.length>0&&t.getImageSize(0,a)})},methods:{getImageSize:function(t,e){var n=this,i=new Image,r=e[t];i.onload=function(){n.previewList.push({src:r.src,w:this.width,h:this.height}),t++,t<e.length?n.getImageSize(t,e):n.$el.addEventListener("click",n.doPreview)},i.src=r.src},doPreview:function(t){var e=this;if(/img/i.test(t.target.tagName)&&!e.showPreview&&!t.target.classList.contains("pswp__img")){e.previewIndex=0;for(var n=0;n<e.previewList.length;n++)if(e.previewList[n].src==t.target.src){e.previewIndex=n;break}e.showPreview=!0}},doHandlerScroll:function(){for(var t,e,n=this,i=n.catalog.length-1;i>=0;i--)if(t=n.catalog[i].el,t.getBoundingClientRect().top<10){e=i;break}n.catalog=n.catalog.map(function(t,n){return t.active=n==e,t})}},beforeDestroy:function(){var t=this;window.removeEventListener("scroll",t.doHandlerScroll),t.previewList.length>0&&t.$el.removeEventListener("click",t.doPreview)}},s=a,c=n("6691"),l=Object(c["a"])(s,i,r,!1,null,null,null);e["a"]=l.exports},"98d4":function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return i})},ab1f:function(t,e,n){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function r(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}n.d(e,"a",function(){return r})},bfed:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"page-container article-page canvas-6-page"},[n("h2",{staticClass:"title"},[t._v("Canvas学习笔记之六：精灵")]),n("div",{staticClass:"content"},[n("h3",{staticClass:"title"},[t._v("概述")]),n("p",[t._v("精灵对象可以接受调用者的命令，来执行某些特定的操作，例如下落、飞行、弹起等。")]),n("p",[t._v("painter属性是一个指向Painter对象的引用，该对象使用paint(sprite, context)方法来绘制精灵；behaviors属性指向一个对象数组，数组中的每个对象都会以execute(sprite,context,time)方法来对精灵进行某种形式的操作：")]),t._m(0),n("p",[t._v("使用精灵绘制的小球：")]),n("div",{staticClass:"exp"},[n("canvas",{ref:"c1",attrs:{width:"300",height:"200"}})]),n("p",[t._v("定义一个painterObj即可：")]),t._m(1),n("h3",{staticClass:"title"},[t._v("绘制器")]),n("p",[t._v("Sprite对象与绘制其内容的绘制器之间是解耦的。如此可在程序运行时动态地设置绘制器，提高了灵活性。")]),t._m(2),n("p",[t._v("多个小球，复用painter：")]),n("div",{staticClass:"exp"},[n("canvas",{ref:"c2",attrs:{width:"300",height:"200"}})]),t._m(3),n("h3",{staticClass:"title"},[t._v("动画循环")]),n("p",[t._v("大部分情况下，基于精灵的可以复用的动画循环模式如下：")]),t._m(4),n("p",[t._v("使用精灵模式实现的三个小球运动动画：")]),n("div",{staticClass:"exp"},[n("canvas",{ref:"c3",attrs:{width:"300",height:"200"}})]),n("p",[t._v("定义绘制器对象和行为对象：")]),t._m(5),n("p",[t._v("添加三个精灵：")]),t._m(6),n("p",[t._v("执行动画函数：")]),t._m(7)]),n("footer",[t._v("2016年07月15日")]),n("Comments"),n("Catalog",{attrs:{catalog:t.catalog}})],1)},r=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("pre",[n("code",[t._v("// canvas 精灵对象\nclass Sprite {\n    constructor (options) {\n        this.name = options.name || 'sprite'\n        this.painter = options.painter\n\n        this.top = options.top || 0\n        this.left = options.left || 0\n        this.width = options.width || 0\n        this.height = options.height || 0\n        this.velocityX = options.velocityX || 0\n        this.velocityY = options.velocityY || 0\n        this.visible = options.visible || true\n        this.animating = options.animating || false\n        this.behaviors = options.behaviors || []\n        // 精灵对象的其他属性\n        Object.keys(options).forEach(key => {\n            if (this[key] == undefined) {\n                this[key] = options[key]\n            }\n        })\n    }\n    paint (context) {\n        if (this.painter && this.visible) {\n            this.painter.paint(this, context)\n        }\n    }\n    update (context, time) {\n        this.behaviors.forEach(behavior => {\n            behavior.execute(this, context, time)\n        })\n    }\n}\nexport default Sprite")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("pre",[n("code",[t._v("const that = this\nconst c1 = that.$refs.c1\nconst ctx = c1.getContext('2d')\nconst radius = 25\nconst painterObj = {\n    paint (sprite, context) {\n        context.beginPath()\n        context.arc(sprite.left + sprite.width / 2, sprite.top + sprite.height / 2, radius, 0, Math.PI * 2, false)\n        context.clip()\n        context.shadowColor = 'rgb(0,0,0)'\n        context.shadowOffsetX = -4\n        context.shadowOffsetY = -4\n        context.shadowBlur = 8\n        context.lineWidth = 2\n        context.strokeStyle = 'rgb(100, 100, 195)'\n        context.fillStyle = 'rgba(30, 144, 255, 0.15)'\n        context.stroke()\n        context.fill()\n    }\n}\nlet ball = new Sprite({\n    painter: painterObj,\n    left: 100,\n    top: 100\n})\nctx.fillStyle = '#ffffff'\nctx.fillRect(0, 0, c1.width, c1.height)\nball.paint(ctx)")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("精灵对象不需要自己完成绘制操作，而是将绘制操作代理给另外一个对象来做。")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("pre",[n("code",[t._v("const that = this\nconst c2 = that.$refs.c2\nconst ctx = c2.getContext('2d')\nconst b1 = new Sprite({\n    painter: painterObj,\n    left: 60,\n    top: 60\n})\nconst b2 = new Sprite({\n    painter: painterObj,\n    left: 160,\n    top: 160\n})\nctx.fillStyle = '#ffffff'\nctx.fillRect(0, 0, c2.width, c2.height)\nb1.paint(ctx)\nb2.paint(ctx)")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("pre",[n("code",[t._v("var sprites = [new Sprite(), ...]\nvar context = ...\nfunction animate (time) {\n    var i = 0\n    ...\n    context.clearRect(0,0,context.canvas.width,context.canvas.height)\n    drawBackground() // 绘制背景\n    for(i = 0; i < sprites.length; i++) { // 更新状态\n        sprites[i].update(context, time)\n    }\n    for(i = 0; i < sprites.length; i++) { // 绘制\n        sprites[i].paint(context)\n    }\n    window.requestAnimationFrame(animate)\n}")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("pre",[n("code",[t._v("const that = this\nconst painter = { // 绘制器对象\n    paint (sprite, context) {\n        let gradient = context.createRadialGradient(sprite.left, sprite.top, 0, sprite.left, sprite.top, sprite.radius)\n        gradient.addColorStop(0.3, sprite.innerColor)\n        gradient.addColorStop(0.5, sprite.middleColor)\n        gradient.addColorStop(1, sprite.outerColor)\n        context.save()\n        context.fillStyle = gradient\n        context.strokeStyle = sprite.strokeStyle\n        context.beginPath()\n        context.arc(sprite.left, sprite.top, sprite.radius, 0, Math.PI * 2, false)\n        context.fill()\n        context.stroke()\n        context.restore()\n    }\n}\nconst move = { // behavior对象\n    execute (sprite, context, time) {\n        if (sprite.left + sprite.velocityX + sprite.radius > context.canvas.width || sprite.left + sprite.velocityX - sprite.radius < 0) {\n            sprite.velocityX = -sprite.velocityX\n        }\n        if (sprite.top + sprite.velocityY + sprite.radius > context.canvas.height || sprite.top + sprite.velocityY - sprite.radius < 0) {\n            sprite.velocityY = -sprite.velocityY\n        }\n        sprite.left += sprite.velocityX\n        sprite.top += sprite.velocityY\n    }\n}")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("pre",[n("code",[t._v("let arr = [] // 添加三个精灵\narr.push(new Sprite({\n    painter: painter,\n    behaviors: [move],\n    left: 50,\n    top: 20,\n    velocityX: -3.2,\n    velocityY: 3.5,\n    radius: 16,\n    innerColor: 'rgba(255,255,0,1)',\n    middleColor: 'rgba(255,255,0,0.7)',\n    outerColor: 'rgba(255,255,0,0.5)',\n    strokeStyle: 'gray'\n}))\narr.push(new Sprite({\n    painter: painter,\n    behaviors: [move],\n    left: 50,\n    top: 150,\n    velocityX: 2.2,\n    velocityY: 2.5,\n    radius: 22,\n    innerColor: 'rgba(100,145,230,1)',\n    middleColor: 'rgba(100,145,230,0.7)',\n    outerColor: 'rgba(100,145,230,0.5)',\n    strokeStyle: 'blue'\n}))\narr.push(new Sprite({\n    painter: painter,\n    behaviors: [move],\n    left: 150,\n    top: 75,\n    velocityX: 1.2,\n    velocityY: 1.5,\n    radius: 18,\n    innerColor: 'rgba(255,0,0,1)',\n    middleColor: 'rgba(255,0,0,0.7)',\n    outerColor: 'rgba(255,0,0,0.5)',\n    strokeStyle: 'orange'\n}))\nthat.sprites = arr\nthat.animate()")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("pre",[n("code",[t._v("animate (time) {\n    const that = this\n    const canvas = that.$refs.c3\n    const ctx = canvas.getContext('2d')\n    ctx.fillStyle = '#ffffff'\n    ctx.fillRect(0, 0, canvas.width, canvas.height)\n    that.sprites.forEach(sprite => {\n        sprite.update(ctx)\n    })\n    that.sprites.forEach(sprite => {\n        sprite.paint(ctx)\n    })\n    window.requestAnimationFrame(that.animate)\n}")])])}],o=(n("f763"),n("1c74"),n("3ad6")),a=n("edea"),s=25,c={paint:function(t,e){e.save(),e.beginPath(),e.arc(t.left+t.width/2,t.top+t.height/2,s,0,2*Math.PI,!1),e.clip(),e.shadowColor="rgb(0,0,0)",e.shadowOffsetX=-4,e.shadowOffsetY=-4,e.shadowBlur=8,e.lineWidth=2,e.strokeStyle="rgb(100, 100, 195)",e.fillStyle="rgba(30, 144, 255, 0.15)",e.stroke(),e.fill(),e.restore()}},l={extends:o["a"],data:function(){return{sprites:[]}},mounted:function(){var t=this;t.$nextTick(function(){t.drawBallBySprite(),t.drawBalls(),t.drawAniBalls()})},methods:{drawBallBySprite:function(){var t=this,e=t.$refs.c1,n=e.getContext("2d"),i=new a["a"]({painter:c,left:100,top:100});n.fillStyle="#ffffff",n.fillRect(0,0,e.width,e.height),i.paint(n)},drawBalls:function(){var t=this,e=t.$refs.c2,n=e.getContext("2d"),i=new a["a"]({painter:c,left:60,top:60}),r=new a["a"]({painter:c,left:160,top:160});n.fillStyle="#ffffff",n.fillRect(0,0,e.width,e.height),i.paint(n),r.paint(n)},drawAniBalls:function(){var t=this,e={paint:function(t,e){var n=e.createRadialGradient(t.left,t.top,0,t.left,t.top,t.radius);n.addColorStop(.3,t.innerColor),n.addColorStop(.5,t.middleColor),n.addColorStop(1,t.outerColor),e.save(),e.fillStyle=n,e.strokeStyle=t.strokeStyle,e.beginPath(),e.arc(t.left,t.top,t.radius,0,2*Math.PI,!1),e.fill(),e.stroke(),e.restore()}},n={execute:function(t,e,n){(t.left+t.velocityX+t.radius>e.canvas.width||t.left+t.velocityX-t.radius<0)&&(t.velocityX=-t.velocityX),(t.top+t.velocityY+t.radius>e.canvas.height||t.top+t.velocityY-t.radius<0)&&(t.velocityY=-t.velocityY),t.left+=t.velocityX,t.top+=t.velocityY}},i=[];i.push(new a["a"]({painter:e,behaviors:[n],left:50,top:20,velocityX:-3.2,velocityY:3.5,radius:16,innerColor:"rgba(255,255,0,1)",middleColor:"rgba(255,255,0,0.7)",outerColor:"rgba(255,255,0,0.5)",strokeStyle:"gray"})),i.push(new a["a"]({painter:e,behaviors:[n],left:50,top:150,velocityX:2.2,velocityY:2.5,radius:22,innerColor:"rgba(100,145,230,1)",middleColor:"rgba(100,145,230,0.7)",outerColor:"rgba(100,145,230,0.5)",strokeStyle:"blue"})),i.push(new a["a"]({painter:e,behaviors:[n],left:150,top:75,velocityX:1.2,velocityY:1.5,radius:18,innerColor:"rgba(255,0,0,1)",middleColor:"rgba(255,0,0,0.7)",outerColor:"rgba(255,0,0,0.5)",strokeStyle:"orange"})),t.sprites=i,t.animate()},animate:function(t){var e=this,n=e.$refs.c3,i=n.getContext("2d");i.fillStyle="#ffffff",i.fillRect(0,0,n.width,n.height),e.sprites.forEach(function(t){t.update(i)}),e.sprites.forEach(function(t){t.paint(i)}),window.requestAnimationFrame(e.animate)}}},p=l,h=n("6691"),f=Object(h["a"])(p,i,r,!1,null,null,null);e["default"]=f.exports},edea:function(t,e,n){"use strict";n.d(e,"a",function(){return o});n("fb37"),n("f763"),n("7364");var i=n("98d4"),r=n("ab1f"),o=function(){function t(e){var n=this;Object(i["a"])(this,t),this.name=e.name||"sprite",this.painter=e.painter,this.top=e.top||0,this.left=e.left||0,this.width=e.width||0,this.height=e.height||0,this.velocityX=e.velocityX||0,this.velocityY=e.velocityY||0,this.visible=e.visible||!0,this.animating=e.animating||!1,this.behaviors=e.behaviors||[],Object.keys(e).forEach(function(t){void 0==n[t]&&(n[t]=e[t])})}return Object(r["a"])(t,[{key:"paint",value:function(t){this.painter&&this.visible&&this.painter.paint(this,t)}},{key:"update",value:function(t,e){var n=this;this.behaviors.forEach(function(i){i.execute(n,t,e)})}}]),t}()}}]);