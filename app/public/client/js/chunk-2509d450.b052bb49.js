(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2509d450"],{"3ad6":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div")},s=[],o=(n("f763"),n("eb57")),a={data:function(){return{catalog:[],showPreview:!1,previewList:[],previewIndex:0}},mounted:function(){var e=this;e.$store.commit(o["a"].SWITCH_LOADING,!1),e.$nextTick(function(){window.addEventListener("scroll",e.doHandlerScroll);var t=document.querySelectorAll("code");t.length>0&&t.forEach(function(e){hljs.highlightBlock(e)});var n=document.querySelectorAll("h3.title");if(n.length>0){var i=[],s=Math.round(1e6*Math.random()),o="";e.catalog=n.forEach(function(e,t){o="section"+s+"-"+t,e.setAttribute("id",o),i.push({text:e.innerHTML,id:o,el:e,active:!1})}),e.catalog=i}var a=document.querySelectorAll(".content figure>img");a.length>0&&e.getImageSize(0,a)})},methods:{getImageSize:function(e,t){var n=this,i=new Image,s=t[e];i.onload=function(){n.previewList.push({src:s.src,w:this.width,h:this.height}),e++,e<t.length?n.getImageSize(e,t):n.$el.addEventListener("click",n.doPreview)},i.src=s.src},doPreview:function(e){var t=this;if(/img/i.test(e.target.tagName)&&!t.showPreview&&!e.target.classList.contains("pswp__img")){t.previewIndex=0;for(var n=0;n<t.previewList.length;n++)if(t.previewList[n].src==e.target.src){t.previewIndex=n;break}t.showPreview=!0}},doHandlerScroll:function(){for(var e,t,n=this,i=n.catalog.length-1;i>=0;i--)if(e=n.catalog[i].el,e.getBoundingClientRect().top<10){t=i;break}n.catalog=n.catalog.map(function(e,n){return e.active=n==t,e})}},beforeDestroy:function(){var e=this;window.removeEventListener("scroll",e.doHandlerScroll),e.previewList.length>0&&e.$el.removeEventListener("click",e.doPreview)}},r=a,l=n("6691"),p=Object(l["a"])(r,i,s,!1,null,null,null);t["a"]=p.exports},c510:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"page-container article-page"},[n("h2",{staticClass:"title"},[e._v("使用PhotoSwipe构建图片预览组件")]),e._m(0),n("footer",[e._v("2018年05月23日")]),n("Comments"),n("Catalog",{attrs:{catalog:e.catalog}})],1)},s=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"content"},[n("h3",{staticClass:"title"},[e._v("概述")]),n("p",[n("a",{attrs:{href:"http://photoswipe.com/"}},[e._v("PhotoSwipe")]),e._v("是一款用于浏览图集的不依赖于其他库的JavaScript插件。功能强大，支持移动端通过手势缩放图片，支持分享、全屏、键盘快捷键等功能。")]),n("p",[e._v("官方文档地址：\n                "),n("a",{attrs:{href:"http://photoswipe.com/documentation/getting-started.html"}},[e._v("http://photoswipe.com/documentation/getting-started.html")])]),n("h3",{staticClass:"title"},[e._v("封装成组件")]),n("p",[e._v("在vue框架中使用的话，先通过npm install photoswipe下载模块。")]),n("p",[e._v("新建组件Preview.vue，其中template结构如下：")]),n("pre",[n("code",[e._v('<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">\n    \x3c!-- Background of PhotoSwipe. It\'s a separate element as animating opacity is faster than rgba(). --\x3e\n    <div class="pswp__bg"></div>\n\n    \x3c!-- Slides wrapper with overflow:hidden. --\x3e\n    <div class="pswp__scroll-wrap">\n        \x3c!-- Container that holds slides.\n            PhotoSwipe keeps only 3 of them in the DOM to save memory.\n            Don\'t modify these 3 pswp__item elements, data is added later on. --\x3e\n        <div class="pswp__container">\n            <div class="pswp__item"></div>\n            <div class="pswp__item"></div>\n            <div class="pswp__item"></div>\n        </div>\n\n        \x3c!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. --\x3e\n        <div class="pswp__ui pswp__ui--hidden">\n            <div class="pswp__top-bar">\n                \x3c!--  Controls are self-explanatory. Order can be changed. --\x3e\n                <div class="pswp__counter"></div>\n                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>\n                \x3c!-- <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button> --\x3e\n                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>\n\n                \x3c!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR --\x3e\n                \x3c!-- element will get class pswp__preloader--active when preloader is running --\x3e\n                <div class="pswp__preloader">\n                    <div class="pswp__preloader__icn">\n                        <div class="pswp__preloader__cut">\n                        <div class="pswp__preloader__donut"></div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \x3c!-- 把左右方向按钮去掉了 --\x3e\n            \x3c!-- <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>\n            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button> --\x3e\n\n            <div class="pswp__caption">\n                <div class="pswp__caption__center"></div>\n            </div>\n        </div>\n    </div>\n</div>')])]),n("p",[e._v("import以下模块：")]),n("pre",[n("code",[e._v("import 'photoswipe/dist/photoswipe.css'\nimport 'photoswipe/dist/default-skin/default-skin.css'\nimport PhotoSwipe from 'photoswipe/dist/photoswipe'\nimport PhotoSwipeUI from 'photoswipe/dist/photoswipe-ui-default'")])]),n("p",[e._v("定义组件的3个prop，其中图片的数据需要src（链接）、w（宽度）、h（高度）三项：")]),n("pre",[n("code",[e._v("props: {\n    list: { // 图片列表 [{ src: '', w: 100, h: 100 }]\n        type: Array,\n        default: []\n    },\n    isShow: { // 控制显示隐藏\n        type: Boolean,\n        default: false\n    },\n    index: 0 // 初始显示的图片索引值\n}")])]),n("p",[e._v("监听isShow，当为true时初始化预览组件：")]),n("pre",[n("code",[e._v("watch: {\n    isShow (newVal, oldVal) {\n        const that = this\n        if (newVal) {\n            let gallery = new PhotoSwipe(that.$el, PhotoSwipeUI, that.list, {\n                index: that.index || 0\n            })\n            gallery.init()\n            gallery.listen('close', () => { // 关闭的时候isShow置为false\n                that.$emit('update:isShow', false)\n            })\n        }\n    }\n}")])]),n("p",[e._v("源码：\n                "),n("a",{attrs:{href:"https://github.com/bravelin/bravelin.github.io/blob/master/source/src/components/Preview.vue"}},[e._v("https://github.com/bravelin/bravelin.github.io/blob/master/source/src/components/Preview.vue")])]),n("h3",{staticClass:"title"},[e._v("使用方法")]),n("p",[e._v("在组件中使用的话，data中定义好list、index、isShow即可：")]),n("pre",[n("code",[e._v('<Preview :is-show.sync="showPreview" :list="previewList" :index="previewIndex"></Preview>')])]),n("p",[e._v("需要预览的话：")]),n("pre",[n("code",[e._v("doPreview (pics, picIndex) {\n    const that = this\n    that.previewList = pics\n    that.previewIndex = picIndex\n    that.showPreview = true\n}")])]),n("p",[e._v("如果需要动态获取页面上的图片，并点击任意一张图片都可以进入预览模式的话，可以如下处理。")]),n("p",[e._v("页面加载之后获取所有img标签：")]),n("pre",[n("code",[e._v("mounted () {\n    const that = this\n    const imageList = document.querySelectorAll('.content figure>img')\n    if (imageList.length > 0) {\n        that.getImageSize(0, imageList) // 获取图片的宽高\n    }\n}")])]),n("p",[e._v("因为预览图片还需要知道图片的宽高，使用队列依次在Image的onload回调函数里面获取：")]),n("pre",[n("code",[e._v("getImageSize (index, imageList) {\n    const that = this\n    let img = new Image()\n    let el = imageList[index]\n    img.onload = function () {\n        that.previewList.push({ // 保存进去\n            src: el.src,\n            w: this.width,\n            h: this.height\n        })\n        index++\n        if (index < imageList.length) {\n            that.getImageSize(index, imageList) // 获取队列中下一个图片的尺寸\n        } else {\n            that.$el.addEventListener('click', that.doPreview) // 对img增加click监听\n        }\n    }\n    img.src = el.src\n}")])]),n("p",[e._v("页面的click事件处理中，如果点击的是图片，则弹出预览：")]),n("pre",[n("code",[e._v("doPreview (e) {\n    const that = this\n    if (/img/i.test(e.target.tagName) && !that.showPreview && !e.target.classList.contains('pswp__img')) {\n        that.previewIndex = 0 // 获取index\n        for (let i = 0; i < that.previewList.length; i++) {\n            if (that.previewList[i].src == e.target.src) {\n                that.previewIndex = i\n                break\n            }\n        }\n        that.showPreview = true\n    }\n}")])])])}],o=n("3ad6"),a={extends:o["a"]},r=a,l=n("6691"),p=Object(l["a"])(r,i,s,!1,null,null,null);t["default"]=p.exports}}]);