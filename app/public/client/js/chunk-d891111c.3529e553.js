(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d891111c"],{"3ad6":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div")},i=[],r=(a("4634"),a("eb57")),o={data:function(){return{catalog:[],showPreview:!1,previewList:[],previewIndex:0}},mounted:function(){var t=this;t.$store.commit(r["a"].SWITCH_LOADING,!1),t.$nextTick((function(){window.addEventListener("scroll",t.doHandlerScroll);var e=document.querySelectorAll("code");e.length>0&&e.forEach((function(t){hljs.highlightBlock(t)}));var a=document.querySelectorAll("h3.title");if(a.length>0){var n=[],i=Math.round(1e6*Math.random()),r="";t.catalog=a.forEach((function(t,e){r="section"+i+"-"+e,t.setAttribute("id",r),n.push({text:t.innerHTML,id:r,el:t,active:!1})})),t.catalog=n}var o=document.querySelectorAll(".content figure>img");o.length>0&&t.getImageSize(0,o)}))},methods:{getImageSize:function(t,e){var a=this,n=new Image,i=e[t];n.onload=function(){a.previewList.push({src:i.src,w:this.width,h:this.height}),t++,t<e.length?a.getImageSize(t,e):a.$el.addEventListener("click",a.doPreview)},n.src=i.src},doPreview:function(t){var e=this;if(/img/i.test(t.target.tagName)&&!e.showPreview&&!t.target.classList.contains("pswp__img")){e.previewIndex=0;for(var a=0;a<e.previewList.length;a++)if(e.previewList[a].src==t.target.src){e.previewIndex=a;break}e.showPreview=!0}},doHandlerScroll:function(){for(var t,e,a=this,n=a.catalog.length-1;n>=0;n--)if(t=a.catalog[n].el,t.getBoundingClientRect().top<10){e=n;break}a.catalog=a.catalog.map((function(t,a){return t.active=a==e,t}))}},beforeDestroy:function(){var t=this;window.removeEventListener("scroll",t.doHandlerScroll),t.previewList.length>0&&t.$el.removeEventListener("click",t.doPreview)}},s=o,c=a("4e82"),d=Object(c["a"])(s,n,i,!1,null,null,null);e["a"]=d.exports},4634:function(t,e,a){for(var n=a("96dd"),i=a("7d56"),r=a("a6d5"),o=a("3f8b"),s=a("b8ea"),c=a("e3b3"),d=a("1277"),l=d("iterator"),g=d("toStringTag"),h=c.Array,m={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},f=i(m),v=0;v<f.length;v++){var u,w=f[v],_=m[w],p=o[w],x=p&&p.prototype;if(x&&(x[l]||s(x,l,h),x[g]||s(x,g,w),c[w]=h,_))for(u in n)x[u]||r(x,u,n[u],!0)}},"9ef3":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"page-container article-page canvas-4-page"},[a("h2",{staticClass:"title"},[t._v("Canvas学习笔记之四：图像与视频")]),a("div",{staticClass:"content"},[t._m(0),a("h3",{staticClass:"title"},[t._v("图像的绘制")]),a("p",[t._v("必须等待图片加载完成之后才能对其进行绘制，如果尚未完成加载，drawImage()方法将会失败，并且没有任何提示。通常绘制的方法会放在onload()回调函数中。")]),a("p",[t._v("图像的绘制效果受制于阴影、剪辑区域、图像合成等因素。")]),a("p",[t._v("drawImage()方法会将一幅图像绘制到canvas中，所绘的图像称之为“源图像”，绘制到的地方称之为“目标canvas”。drawImage()可以接收以下3套参数：")]),t._m(1),t._m(2),t._m(3),a("p",[t._v("第一个参数可以是图像对象，也可以是一个canvas对象，或者video视频对象。")]),a("div",{staticClass:"exp"},[a("canvas",{ref:"c1",attrs:{width:"300",height:"200"}})]),t._m(4),t._m(5),a("h3",{staticClass:"title"},[t._v("离屏Canvas")]),a("p",[t._v("离屏Canavs通常用来存放临时性的图像信息：")]),a("p",[t._v("1、创建用做离屏Canvas的元素；")]),a("p",[t._v("2、设置离屏Canvas的宽度与高度；")]),a("p",[t._v("3、在离屏Canvas中进行绘制；")]),a("p",[t._v("4、将离屏Canvas的全部或者一部分内容复制到正在显示的Canvas中。")]),a("div",{staticClass:"exp"},[a("canvas",{ref:"c2",attrs:{width:"300",height:"200"},on:{mousemove:t.doMouseMoveForMagnifier,touchmove:t.doMouseMoveForMagnifier}})]),t._m(6),a("p",[t._v("DOM结构：")]),t._m(7),a("p",[t._v("mousemove事件与touchmove事件处理：")]),t._m(8),a("h3",{staticClass:"title"},[t._v("操作像素")]),a("p",[t._v("两个方法：getImageData()和putImageData()。")]),a("p",[t._v("getImageData方法所返回的ImageData对象包含下列三个属性：width、height、data。")]),a("p",[t._v("putImageData(Image,dx,dy,dirtyX,dirtyY,dirtyWidth,dirtyHeight)，其中dx与dy表示所绘制的图像距离canvas左上角的X、Y偏移量；方法的最后4个参数代表以设备为单位的脏矩形，当浏览器将脏矩形复制到canvas时，它会将设备像素转换为CSS像素。")]),t._m(9),t._m(10),a("div",{staticClass:"exp"},[a("canvas",{ref:"c3",attrs:{width:"300",height:"200"}})]),t._m(11),t._m(12),a("div",{staticClass:"exp"},[a("canvas",{ref:"c4",attrs:{width:"300",height:"200"}})]),t._m(13),t._m(14),a("div",{staticClass:"exp"},[a("canvas",{ref:"c5",attrs:{width:"300",height:"200"}})]),t._m(15),t._m(16)]),a("footer",[t._v("2016年06月30日")]),a("Comments"),a("Catalog",{attrs:{catalog:t.catalog}})],1)},i=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",[t._v("Canvas环境对象提供了4个用于绘制及操作图像的方法：\n            "),a("strong",[t._v("drawImage、putImageData、getImageData、createImageData")]),t._v("。")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",[a("strong",[t._v("drawImage(image, dx, dy)")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",[a("strong",[t._v("drawImage(image, dx, dy, dw, dh)")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",[a("strong",[t._v("drawImage(image, sx, sy, sw, sh, dx, dy, dw, dh)")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("pre",[a("code",[t._v("let that = this\nlet el = that.$refs.c1\nlet context = el.getContext('2d')\nlet w = el.width\nlet h = el.height\nlet img = new Image()\nimg.onload = function () { // 在image的onload事件中绘制\n    context.drawImage(img, 0, 0, w, h)\n}\nimg.src = './static/img/1.jpeg'")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",[a("strong",[t._v("在使用drawImage方法时，务必保证所绘图片已经加载好了。")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("pre",[a("code",[t._v("drawMagnifier () {\n    let that = this\n    let el = that.$refs.c2\n    let context = el.getContext('2d')\n    let w = el.width\n    let h = el.height\n    that.offScreenCanvas = document.createElement('canvas')\n    let offScreenContext = that.offScreenCanvas.getContext('2d')\n    that.offScreenCanvas.width = w\n    that.offScreenCanvas.height = h\n    let img = new Image()\n    img.onload = function () {\n        context.drawImage(img, 0, 0, w, h)\n        offScreenContext.drawImage(img, 0, 0, w, h)\n        that.addMagnifier(context, w, h, w / 2, h / 2, img)\n    }\n    img.src = './static/img/1.jpeg'\n}\n// 绘制放大镜\naddMagnifier (context, w, h, x, y, img) {\n    const that = this\n    let scale = 1.8\n    let radius = 20\n    context.save()\n    context.beginPath()\n    context.strokeStyle = '#ffffff'\n    context.lineWidth = 2\n    context.shadowColor = 'rgba(0,0,0,0.8)'\n    context.shadowOffsetX = 8\n    context.shadowOffsetY = 8\n    context.shadowBlur = 10\n    context.arc(x, y, radius, 0, 2 * Math.PI, true)\n    context.stroke()\n    context.clip()\n    context.drawImage(that.offScreenCanvas, x - radius / scale, y - radius / scale, (radius / scale) * 2, (radius / scale) * 2, x - radius, y - radius, radius * 2, radius * 2)\n    context.restore()\n}")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("pre",[a("code",[t._v('<canvas ref="c2" width="300" height="200" @mousemove="doMouseMoveForMagnifier" @touchmove="doMouseMoveForMagnifier"></canvas>')])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("pre",[a("code",[t._v("doMouseMoveForMagnifier (e) {\n    const that = this\n    let el = that.$refs.c2\n    let context = el.getContext('2d')\n    let w = el.width\n    let h = el.height\n    let img = new Image()\n    let pos = that.windowToCanvas(el, e.clientX, e.clientY)\n    img.onload = function () {\n        context.clearRect(0, 0, w, h)\n        context.drawImage(img, 0, 0, w, h)\n        that.addMagnifier(context, w, h, pos.x, pos.y, that.offScreenCanvas, img)\n    }\n    img.src = './static/img/1.jpeg' // 图片地址\n}")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",[a("strong",[t._v("putImageData方法不受全局设置（globalAlpha、globalCompositeOperation等）的影响。因为它是直接操作像素的。")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",[a("em",[t._v("负片滤镜")]),t._v("：从255中减去每个RGB分量值，再将差值设置回去，相当于“反转”了该像素的颜色。")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("pre",[a("code",[t._v("let imgData = context.getImageData(0, 0, w, h)\nfor (let i = 0; i < imgData.data.length; i = i + 4) {\n    imgData.data[i] = 255 - imgData.data[i]\n    imgData.data[i + 1] = 255 - imgData.data[i + 1]\n    imgData.data[i + 2] = 255 - imgData.data[i + 2]\n}\ncontext.putImageData(imgData, 0, 0)")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",[a("em",[t._v("黑白滤镜")]),t._v("：计算每个像素的RGB分量的平均值，然后将三个分量都设置为这个均值，于是图片由彩色变成了灰白了。")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("pre",[a("code",[t._v("let imgData = context.getImageData(0, 0, w, h)\nlet v\nfor (let i = 0; i < imgData.data.length; i = i + 4) {\n    v = (imgData.data[i] + imgData.data[i + 1] + imgData.data[i + 2]) / 3\n    imgData.data[i] = v\n    imgData.data[i + 1] = v\n    imgData.data[i + 2] = v\n}\ncontext.putImageData(imgData, 0, 0)")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",[a("em",[t._v("浮雕滤镜")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("pre",[a("code",[t._v("let imgData = context.getImageData(0, 0, w, h)\nlet data = imgData.data\nlet width = imgData.width\nlet length = data.length\nfor (let i = 0; i < length; i++) {\n    if (i <= length - width * 4) { // 最后一行像素点特殊处理\n        if ((i + 1) % 4 !== 0) { //RGB分量\n            if ((i + 4) % (width * 4) == 0) { // 每一行最后一个像素点\n                data[i] = data[i - 4]\n                data[i + 1] = data[i - 3]\n                data[i + 2] = data[i - 2]\n                data[i + 3] = data[i - 1]\n                i += 4\n            } else {\n                data[i] = 255 / 2 + 2 * data[i] - data[i + 4] - data[i + width * 4] // 关键点\n            }\n        }\n    } else {\n        if ((i + 1) % 4 !== 0) {\n            data[i] = data[i - width * 4]\n        }\n    }\n}\ncontext.putImageData(imgData, 0, 0)")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",[a("strong",[t._v("如果在大一些的图片上应用复杂的处理算法，可以使用WebWorker。")])])}],r=a("3ad6"),o="https://bravelin.top/group1/M00/00/60/fwAAAV1UFGSAXStZAABiVm_g4WI96.jpeg",s={extends:r["a"],data:function(){return{offScreenCanvas:null}},mounted:function(){var t=this;t.$nextTick((function(){t.drawImg(),t.drawMagnifier(),t.negativeFilter(),t.greyFilter(),t.embossFilter()}))},methods:{drawImg:function(){var t=this,e=t.$refs.c1,a=e.getContext("2d"),n=e.width,i=e.height,r=new Image;r.onload=function(){a.drawImage(r,0,0,n,i)},r.src=o},drawMagnifier:function(){var t=this,e=t.$refs.c2,a=e.getContext("2d"),n=e.width,i=e.height;t.offScreenCanvas=document.createElement("canvas");var r=t.offScreenCanvas.getContext("2d");t.offScreenCanvas.width=n,t.offScreenCanvas.height=i;var s=new Image;s.onload=function(){a.drawImage(s,0,0,n,i),r.drawImage(s,0,0,n,i),t.addMagnifier(a,n,i,n/2,i/2,s)},s.src=o},addMagnifier:function(t,e,a,n,i,r){var o=this,s=1.8,c=20;t.save(),t.beginPath(),t.strokeStyle="#ffffff",t.lineWidth=2,t.shadowColor="rgba(0,0,0,0.8)",t.shadowOffsetX=8,t.shadowOffsetY=8,t.shadowBlur=10,t.arc(n,i,c,0,2*Math.PI,!0),t.stroke(),t.clip(),t.drawImage(o.offScreenCanvas,n-c/s,i-c/s,c/s*2,c/s*2,n-c,i-c,2*c,2*c),t.restore()},windowToCanvas:function(t,e,a){var n=t.getBoundingClientRect();return{x:(e-n.left)*(t.width/n.width),y:(a-n.top)*(t.height/n.height)}},doMouseMoveForMagnifier:function(t){var e=this,a=e.$refs.c2,n=a.getContext("2d"),i=a.width,r=a.height,s=new Image,c=e.windowToCanvas(a,t.clientX,t.clientY);s.onload=function(){n.clearRect(0,0,i,r),n.drawImage(s,0,0,i,r),e.addMagnifier(n,i,r,c.x,c.y,e.offScreenCanvas,s)},s.src=o},negativeFilter:function(){var t=this,e=t.$refs.c3,a=e.getContext("2d"),n=e.width,i=e.height,r=new Image;r.onload=function(){a.drawImage(r,0,0,n,i);for(var t=a.getImageData(0,0,n,i),e=0;e<t.data.length;e+=4)t.data[e]=255-t.data[e],t.data[e+1]=255-t.data[e+1],t.data[e+2]=255-t.data[e+2];a.putImageData(t,0,0)},r.src=o},greyFilter:function(){var t=this,e=t.$refs.c4,a=e.getContext("2d"),n=e.width,i=e.height,r=new Image;r.onload=function(){a.drawImage(r,0,0,n,i);for(var t,e=a.getImageData(0,0,n,i),o=0;o<e.data.length;o+=4)t=(e.data[o]+e.data[o+1]+e.data[o+2])/3,e.data[o]=t,e.data[o+1]=t,e.data[o+2]=t;a.putImageData(e,0,0)},r.src=o},embossFilter:function(){var t=this,e=t.$refs.c5,a=e.getContext("2d"),n=e.width,i=e.height,r=new Image;r.onload=function(){a.drawImage(r,0,0,n,i);for(var t=a.getImageData(0,0,n,i),e=t.data,o=t.width,s=e.length,c=0;c<s;c++)c<=s-4*o?(c+1)%4!==0&&((c+4)%(4*o)==0?(e[c]=e[c-4],e[c+1]=e[c-3],e[c+2]=e[c-2],e[c+3]=e[c-1],c+=4):e[c]=127.5+2*e[c]-e[c+4]-e[c+4*o]):(c+1)%4!==0&&(e[c]=e[c-4*o]);a.putImageData(t,0,0)},r.src=o}}},c=s,d=a("4e82"),l=Object(d["a"])(c,n,i,!1,null,null,null);e["default"]=l.exports}}]);