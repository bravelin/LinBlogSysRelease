(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-09ef3557"],{"15c2":function(t,e,n){"use strict";var i=n("db4b"),a=n("5fe5"),r=n("b146");t.exports=function(t){var e=i(this),n=r(e.length),o=arguments.length,c=a(o>1?arguments[1]:void 0,n),s=o>2?arguments[2]:void 0,l=void 0===s?n:a(s,n);while(l>c)e[c++]=t;return e}},"1c74":function(t,e,n){var i=n("b2f5");i(i.P,"Array",{fill:n("15c2")}),n("644a")("fill")},"312b":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"page-container article-page canvas-5-page"},[n("h2",{staticClass:"title"},[t._v("Canvas学习笔记之五：动画")]),n("div",{staticClass:"content"},[n("h3",{staticClass:"title"},[t._v("动画循环")]),t._m(0),n("p",[t._v("不需要指定帧速率，浏览器会自行决定最佳的帧速率。cancelRequestAnimationFrame()可以取消回调函数。")]),n("p",[t._v("使用requestAnimationFrame的polyfill代码：")]),t._m(1),t._m(2),n("div",{staticClass:"exp"},[n("canvas",{ref:"c1",staticStyle:{height:"400px"},attrs:{width:"300",height:"400"}})]),n("p",[t._v("定义数据结构：")]),t._m(3),n("p",[t._v("绘制的方法：")]),t._m(4),n("p",[t._v("更新位置的方法：")]),t._m(5),n("p",[t._v("动画方法：")]),t._m(6),n("h3",{staticClass:"title"},[t._v("帧速率的计算")]),n("p",[t._v("可以根据当前帧距离上一帧的时间，计算出动画每秒钟播放的帧数（frame per second，fps）。")]),t._m(7),n("h3",{staticClass:"title"},[t._v("动画的一些原则")]),t._m(8),t._m(9),t._m(10),t._m(11)]),n("footer",[t._v("2016年07月10日")]),n("Comments"),n("Catalog",{attrs:{catalog:t.catalog}})],1)},a=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[t._v("实现动画循环的首选方式，是使用\n                "),n("strong",[t._v("requestAnimationFrame()")]),t._v("方法，而不是使用setInterval和setTimeout方法。")])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("pre",[n("code",[t._v("window.requestAnimationFrame = (function () {\n    return window.requestAnimationFrame ||\n        window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.msRequestAnimationFrame ||\n        function (callback, element) {\n            var self = this\n            var start\n            var finish\n            window.setTimeout(function () {\n                start = +new Date()\n                callback(start)\n                finish = +new Date()\n                self.timeout = 1000 / 60 - (finish - start) // 大约60fps\n            }, self.timeout)\n        }\n})()")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("em",[t._v("3个小球的匀速运动：")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("pre",[n("code",[t._v("discs: [\n    {\n        x: 150,\n        y: 80,\n        lastX: 150,\n        lastY: 80,\n        velocityX: -3.2,\n        velocityY: 3.5,\n        radius: 25,\n        innerColor: 'rgba(255,255,0,1)',\n        middleColor: 'rgba(255,255,0,0.7)',\n        outerColor: 'rgba(255,255,0,0.5)',\n        strokeStyle: 'gray'\n    },\n    {\n        x: 50,\n        y: 150,\n        lastX: 50,\n        lastY: 150,\n        velocityX: 2.2,\n        velocityY: 2.5,\n        radius: 25,\n        innerColor: 'rgba(100,145,230,1)',\n        middleColor: 'rgba(100,145,230,0.7)',\n        outerColor: 'rgba(100,145,230,0.5)',\n        strokeStyle: 'blue'\n    },\n    {\n        x: 150,\n        y: 75,\n        lastX: 150,\n        lastY: 75,\n        velocityX: 1.2,\n        velocityY: 1.5,\n        radius: 25,\n        innerColor: 'rgba(255,0,0,1)',\n        middleColor: 'rgba(255,0,0,0.7)',\n        outerColor: 'rgba(255,0,0,0.5)',\n        strokeStyle: 'orange'\n    }\n]")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("pre",[n("code",[t._v("draw () {\n    const that = this\n    const canvas = that.$refs.c1\n    const ctx = that.ctx\n    let gradient\n    ctx.fillStyle = '#ffffff'\n    ctx.clearRect(0, 0, canvas.width, canvas.height)\n    ctx.fillRect(0, 0, canvas.width, canvas.height)\n    that.discs.forEach(disc => {\n        gradient = ctx.createRadialGradient(disc.x, disc.y, 0, disc.x, disc.y, disc.radius)\n        gradient.addColorStop(0.3, disc.innerColor)\n        gradient.addColorStop(0.5, disc.middleColor)\n        gradient.addColorStop(1, disc.outerColor)\n        ctx.save()\n        ctx.beginPath()\n        ctx.arc(disc.x, disc.y, disc.radius, 0, Math.PI * 2, false)\n        ctx.fillStyle = gradient\n        ctx.strokeStyle = disc.strokeStyle\n        ctx.fill()\n        ctx.stroke()\n        ctx.restore()\n      })\n    }")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("pre",[n("code",[t._v("update () {\n    const that = this\n    that.discs.forEach(disc => {\n        if (disc.x + disc.velocityX + disc.radius > that.ctx.canvas.width || disc.x + disc.velocityX - disc.radius < 0) {\n            disc.velocityX = -disc.velocityX\n        }\n        if (disc.y + disc.velocityY + disc.radius > that.ctx.canvas.height || disc.y + disc.velocityY - disc.radius < 0) {\n            disc.velocityY = -disc.velocityY\n        }\n        disc.x += disc.velocityX\n        disc.y += disc.velocityY\n    })\n}")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("pre",[n("code",[t._v("animate () {\n    const that = this\n    that.update()\n    that.draw()\n    window.requestAnimationFrame(that.animate)\n}")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("pre",[n("code",[t._v("var lastTime = 0\nfunction calculateFps () {\n    var now = (+new Date())\n    var fps = 1000 / (now - lastTime)\n    lastTime = now\n    return fps\n}")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("将业务逻辑的更新与动画的绘制分开；")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("使用“基于时间的运动”来协调动画的播放速度；")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("使用剪辑区域或图块复制技术将复杂的背景恢复到屏幕之上；")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[n("strong",[t._v("必要时可使用一个或者多个离屏缓冲区以提升绘制速度；")])])}],r=(n("1c74"),n("f763"),n("3ad6")),o={extends:r["a"],data:function(){return{lastTime:0,discs:[{x:150,y:80,lastX:150,lastY:80,velocityX:-32,velocityY:35,radius:20,innerColor:"rgba(255,255,0,1)",middleColor:"rgba(255,255,0,0.7)",outerColor:"rgba(255,255,0,0.5)",strokeStyle:"gray"},{x:50,y:150,lastX:50,lastY:150,velocityX:22,velocityY:25,radius:20,innerColor:"rgba(100,145,230,1)",middleColor:"rgba(100,145,230,0.7)",outerColor:"rgba(100,145,230,0.5)",strokeStyle:"blue"},{x:150,y:75,lastX:150,lastY:75,velocityX:12,velocityY:15,radius:20,innerColor:"rgba(255,0,0,1)",middleColor:"rgba(255,0,0,0.7)",outerColor:"rgba(255,0,0,0.5)",strokeStyle:"orange"}],ctx:null}},mounted:function(){var t=this;t.$nextTick(function(){t.startAnimation()})},methods:{init:function(){window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){var n,i,a=this;window.setTimeout(function(){n=+new Date,t(n),i=+new Date,a.timeout=1e3/60-(i-n)},a.timeout)}}()},startAnimation:function(){var t=this;t.ctx=t.$refs.c1.getContext("2d"),t.animate()},animate:function(){var t=this;t.update(),t.draw(),window.requestAnimationFrame(t.animate)},draw:function(){var t,e=this,n=e.$refs.c1,i=e.ctx;i.fillStyle="#ffffff",i.clearRect(0,0,n.width,n.height),i.fillRect(0,0,n.width,n.height),e.discs.forEach(function(e){t=i.createRadialGradient(e.x,e.y,0,e.x,e.y,e.radius),t.addColorStop(.3,e.innerColor),t.addColorStop(.5,e.middleColor),t.addColorStop(1,e.outerColor),i.save(),i.beginPath(),i.arc(e.x,e.y,e.radius,0,2*Math.PI,!1),i.fillStyle=t,i.strokeStyle=e.strokeStyle,i.fill(),i.stroke(),i.restore()})},update:function(){var t=this,e=0,n=0,i=+new Date,a=t.lastTime?i-t.lastTime:0;t.discs.forEach(function(i){e=i.velocityX*(a/1e3),n=i.velocityY*(a/1e3),(i.x+e+i.radius>t.ctx.canvas.width||i.x+e-i.radius<0)&&(i.velocityX=-i.velocityX),(i.y+n+i.radius>t.ctx.canvas.height||i.y+n-i.radius<0)&&(i.velocityY=-i.velocityY),i.x+=e,i.y+=n}),t.lastTime=i}}},c=o,s=n("17cc"),l=Object(s["a"])(c,i,a,!1,null,null,null);e["default"]=l.exports},"3ad6":function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div")},a=[],r=(n("f763"),n("eb57")),o={data:function(){return{catalog:[],showPreview:!1,previewList:[],previewIndex:0}},mounted:function(){var t=this;t.$store.commit(r["a"].SWITCH_LOADING,!1),t.$nextTick(function(){window.addEventListener("scroll",t.doHandlerScroll);var e=document.querySelectorAll("code");e.length>0&&e.forEach(function(t){hljs.highlightBlock(t)});var n=document.querySelectorAll("h3.title");if(n.length>0){var i=[],a=Math.round(1e6*Math.random()),r="";t.catalog=n.forEach(function(t,e){r="section"+a+"-"+e,t.setAttribute("id",r),i.push({text:t.innerHTML,id:r,el:t,active:!1})}),t.catalog=i}var o=document.querySelectorAll(".content figure>img");o.length>0&&t.getImageSize(0,o)})},methods:{getImageSize:function(t,e){var n=this,i=new Image,a=e[t];i.onload=function(){n.previewList.push({src:a.src,w:this.width,h:this.height}),t++,t<e.length?n.getImageSize(t,e):n.$el.addEventListener("click",n.doPreview)},i.src=a.src},doPreview:function(t){var e=this;if(/img/i.test(t.target.tagName)&&!e.showPreview&&!t.target.classList.contains("pswp__img")){e.previewIndex=0;for(var n=0;n<e.previewList.length;n++)if(e.previewList[n].src==t.target.src){e.previewIndex=n;break}e.showPreview=!0}},doHandlerScroll:function(){for(var t,e,n=this,i=n.catalog.length-1;i>=0;i--)if(t=n.catalog[i].el,t.getBoundingClientRect().top<10){e=i;break}n.catalog=n.catalog.map(function(t,n){return t.active=n==e,t})}},beforeDestroy:function(){var t=this;window.removeEventListener("scroll",t.doHandlerScroll),t.previewList.length>0&&t.$el.removeEventListener("click",t.doPreview)}},c=o,s=n("17cc"),l=Object(s["a"])(c,i,a,!1,null,null,null);e["a"]=l.exports}}]);